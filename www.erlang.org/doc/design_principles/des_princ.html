<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html xmlns:fn="http://www.w3.org/2005/02/xpath-functions">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="../otp_doc.css" type="text/css">
<title>Erlang -- Overview</title>
</head>
<body bgcolor="white" text="#000000" link="#0000ff" vlink="#ff00ff" alink="#ff0000"><div id="container">
<script id="js" type="text/javascript" language="JavaScript" src="../js/flipmenu/flipmenu.js"></script><script id="js2" type="text/javascript" src="../js/erlresolvelinks.js"></script><div id="leftnav"><div class="innertube">
<img alt="Erlang logo" src="../erlang-logo.png"><br><small>
<a href="users_guide.html">User's Guide</a><br>
<a href="../pdf/otp-system-documentation.pdf">PDF</a><br>
<a href="../index.html">Top</a></small><p><strong>OTP Design Principles</strong><br><strong>User's Guide</strong><br><small>Version 5.7.4</small></p>
<br>
<a href="javascript:openAllFlips()">Expand All</a><br>
<a href="javascript:closeAllFlips()">Contract All</a><p><small><strong>Chapters</strong></small></p>
<ul class="flipMenu" imagepath="../js/flipmenu">
<li title="Overview" expanded="true">Overview<ul>
<li>
<a href="des_princ.html">
              Top of chapter
            </a></li>
<li title="Supervision Trees">
<a href="des_princ.html#id2252268">Supervision Trees</a></li>
<li title="Behaviours">
<a href="des_princ.html#id2258984">Behaviours</a></li>
<li title="Applications">
<a href="des_princ.html#id2252297">Applications</a></li>
<li title="Releases">
<a href="des_princ.html#id2252171">Releases</a></li>
<li title="Release Handling">
<a href="des_princ.html#id2254710">Release Handling</a></li>
</ul>
</li>
<li title="Gen_Server Behaviour" expanded="false">Gen_Server Behaviour<ul>
<li>
<a href="gen_server_concepts.html">
              Top of chapter
            </a></li>
<li title="Client-Server Principles">
<a href="gen_server_concepts.html#id2252090">Client-Server Principles</a></li>
<li title="Example">
<a href="gen_server_concepts.html#id2252110">Example</a></li>
<li title="Starting a Gen_Server">
<a href="gen_server_concepts.html#id2258596">Starting a Gen_Server</a></li>
<li title="Synchronous Requests - Call">
<a href="gen_server_concepts.html#id2267098">Synchronous Requests - Call</a></li>
<li title="Asynchronous Requests - Cast">
<a href="gen_server_concepts.html#id2262742">Asynchronous Requests - Cast</a></li>
<li title="Stopping">
<a href="gen_server_concepts.html#id2264124">Stopping</a></li>
<li title="Handling Other Messages">
<a href="gen_server_concepts.html#id2264230">Handling Other Messages</a></li>
</ul>
</li>
<li title="Gen_Fsm Behaviour" expanded="false">Gen_Fsm Behaviour<ul>
<li>
<a href="fsm.html">
              Top of chapter
            </a></li>
<li title="Finite State Machines">
<a href="fsm.html#id2251340">Finite State Machines</a></li>
<li title="Example">
<a href="fsm.html#id2256726">Example</a></li>
<li title="Starting a Gen_Fsm">
<a href="fsm.html#id2261953">Starting a Gen_Fsm</a></li>
<li title="Notifying About Events">
<a href="fsm.html#id2258488">Notifying About Events</a></li>
<li title="Timeouts">
<a href="fsm.html#id2258580">Timeouts</a></li>
<li title="All State Events">
<a href="fsm.html#id2264981">All State Events</a></li>
<li title="Stopping">
<a href="fsm.html#id2265017">Stopping</a></li>
<li title="Handling Other Messages">
<a href="fsm.html#id2266792">Handling Other Messages</a></li>
</ul>
</li>
<li title="Gen_Event Behaviour" expanded="false">Gen_Event Behaviour<ul>
<li>
<a href="events.html">
              Top of chapter
            </a></li>
<li title="Event Handling Principles">
<a href="events.html#id2267995">Event Handling Principles</a></li>
<li title="Example">
<a href="events.html#id2268056">Example</a></li>
<li title="Starting an Event Manager">
<a href="events.html#id2268104">Starting an Event Manager</a></li>
<li title="Adding an Event Handler">
<a href="events.html#id2268171">Adding an Event Handler</a></li>
<li title="Notifying About Events">
<a href="events.html#id2268262">Notifying About Events</a></li>
<li title="Deleting an Event Handler">
<a href="events.html#id2268339">Deleting an Event Handler</a></li>
<li title="Stopping">
<a href="events.html#id2268420">Stopping</a></li>
</ul>
</li>
<li title="Supervisor Behaviour" expanded="false">Supervisor Behaviour<ul>
<li>
<a href="sup_princ.html">
              Top of chapter
            </a></li>
<li title="Supervision Principles">
<a href="sup_princ.html#id2268545">Supervision Principles</a></li>
<li title="Example">
<a href="sup_princ.html#id2268573">Example</a></li>
<li title="Restart Strategy">
<a href="sup_princ.html#id2268648">Restart Strategy</a></li>
<li title="Maximum Restart Frequency">
<a href="sup_princ.html#id2266142">Maximum Restart Frequency</a></li>
<li title="Child Specification">
<a href="sup_princ.html#id2266207">Child Specification</a></li>
<li title="Starting a Supervisor">
<a href="sup_princ.html#id2266525">Starting a Supervisor</a></li>
<li title="Adding a Child Process">
<a href="sup_princ.html#id2266650">Adding a Child Process</a></li>
<li title="Stopping a Child Process">
<a href="sup_princ.html#id2266699">Stopping a Child Process</a></li>
<li title="Simple-One-For-One Supervisors">
<a href="sup_princ.html#id2268750">Simple-One-For-One Supervisors</a></li>
<li title="Stopping">
<a href="sup_princ.html#id2268847">Stopping</a></li>
</ul>
</li>
<li title="Sys and Proc_Lib" expanded="false">Sys and Proc_Lib<ul>
<li>
<a href="spec_proc.html">
              Top of chapter
            </a></li>
<li title="Simple Debugging">
<a href="spec_proc.html#id2268956">Simple Debugging</a></li>
<li title="Special Processes">
<a href="spec_proc.html#id2269055">Special Processes</a></li>
<li title="User-Defined Behaviours">
<a href="spec_proc.html#id2269737">User-Defined Behaviours</a></li>
</ul>
</li>
<li title="Applications" expanded="false">Applications<ul>
<li>
<a href="applications.html">
              Top of chapter
            </a></li>
<li title="Application Concept">
<a href="applications.html#id2269898">Application Concept</a></li>
<li title="Application Callback Module">
<a href="applications.html#id2269972">Application Callback Module</a></li>
<li title="Application Resource File">
<a href="applications.html#id2270097">Application Resource File</a></li>
<li title="Directory Structure">
<a href="applications.html#id2270364">Directory Structure</a></li>
<li title="Application Controller">
<a href="applications.html#id2270499">Application Controller</a></li>
<li title="Loading and Unloading Applications">
<a href="applications.html#id2270536">Loading and Unloading Applications</a></li>
<li title="Starting and Stopping Applications">
<a href="applications.html#id2270605">Starting and Stopping Applications</a></li>
<li title="Configuring an Application">
<a href="applications.html#id2270704">Configuring an Application</a></li>
<li title="Application Start Types">
<a href="applications.html#id2270920">Application Start Types</a></li>
</ul>
</li>
<li title="Included Applications" expanded="false">Included Applications<ul>
<li>
<a href="included_applications.html">
              Top of chapter
            </a></li>
<li title="Definition">
<a href="included_applications.html#id2271074">Definition</a></li>
<li title="Specifying Included Applications">
<a href="included_applications.html#id2271148">Specifying Included Applications</a></li>
<li title="Synchronizing Processes During Startup">
<a href="included_applications.html#id2271177">Synchronizing Processes During Startup</a></li>
</ul>
</li>
<li title="Distributed Applications" expanded="false">Distributed Applications<ul>
<li>
<a href="distributed_applications.html">
              Top of chapter
            </a></li>
<li title="Definition">
<a href="distributed_applications.html#id2271422">Definition</a></li>
<li title="Specifying Distributed Applications">
<a href="distributed_applications.html#id2271465">Specifying Distributed Applications</a></li>
<li title="Starting and Stopping Distributed Applications">
<a href="distributed_applications.html#id2271692">Starting and Stopping Distributed Applications</a></li>
<li title="Failover">
<a href="distributed_applications.html#id2271804">Failover</a></li>
<li title="Takeover">
<a href="distributed_applications.html#id2271956">Takeover</a></li>
</ul>
</li>
<li title="Releases" expanded="false">Releases<ul>
<li>
<a href="release_structure.html">
              Top of chapter
            </a></li>
<li title="Release Concept">
<a href="release_structure.html#id2272165">Release Concept</a></li>
<li title="Release Resource File">
<a href="release_structure.html#id2272223">Release Resource File</a></li>
<li title="Generating Boot Scripts">
<a href="release_structure.html#id2272372">Generating Boot Scripts</a></li>
<li title="Creating a Release Package">
<a href="release_structure.html#id2272480">Creating a Release Package</a></li>
<li title="Directory Structure">
<a href="release_structure.html#id2272613">Directory Structure</a></li>
</ul>
</li>
<li title="Release Handling" expanded="false">Release Handling<ul>
<li>
<a href="release_handling.html">
              Top of chapter
            </a></li>
<li title="Release Handling Principles">
<a href="release_handling.html#id2272899">Release Handling Principles</a></li>
<li title="Requirements">
<a href="release_handling.html#id2273174">Requirements</a></li>
<li title="Distributed Systems">
<a href="release_handling.html#id2273276">Distributed Systems</a></li>
<li title="Release Handling Instructions">
<a href="release_handling.html#id2273306">Release Handling Instructions</a></li>
<li title="Application Upgrade File">
<a href="release_handling.html#id2273789">Application Upgrade File</a></li>
<li title="Release Upgrade File">
<a href="release_handling.html#id2273992">Release Upgrade File</a></li>
<li title="Installing a Release">
<a href="release_handling.html#id2274164">Installing a Release</a></li>
<li title="Updating Application Specifications">
<a href="release_handling.html#id2274681">Updating Application Specifications</a></li>
</ul>
</li>
<li title="Appup Cookbook" expanded="false">Appup Cookbook<ul>
<li>
<a href="appup_cookbook.html">
              Top of chapter
            </a></li>
<li title="Changing a Functional Module">
<a href="appup_cookbook.html#id2274885">Changing a Functional Module</a></li>
<li title="Changing a Residence Module">
<a href="appup_cookbook.html#id2274910">Changing a Residence Module</a></li>
<li title="Changing a Callback Module">
<a href="appup_cookbook.html#id2274952">Changing a Callback Module</a></li>
<li title="Changing Internal State">
<a href="appup_cookbook.html#id2275007">Changing Internal State</a></li>
<li title="Module Dependencies">
<a href="appup_cookbook.html#id2275158">Module Dependencies</a></li>
<li title="Changing Code For a Special Process">
<a href="appup_cookbook.html#id2275341">Changing Code For a Special Process</a></li>
<li title="Changing a Supervisor">
<a href="appup_cookbook.html#id2275527">Changing a Supervisor</a></li>
<li title="Adding or Deleting a Module">
<a href="appup_cookbook.html#id2275808">Adding or Deleting a Module</a></li>
<li title="Starting or Terminating a Process">
<a href="appup_cookbook.html#id2275834">Starting or Terminating a Process</a></li>
<li title="Adding or Removing an Application">
<a href="appup_cookbook.html#id2275854">Adding or Removing an Application</a></li>
<li title="Restarting an Application">
<a href="appup_cookbook.html#id2275887">Restarting an Application</a></li>
<li title="Changing an Application Specification">
<a href="appup_cookbook.html#id2275933">Changing an Application Specification</a></li>
<li title="Changing Application Configuration">
<a href="appup_cookbook.html#id2275959">Changing Application Configuration</a></li>
<li title="Changing Included Applications">
<a href="appup_cookbook.html#id2275995">Changing Included Applications</a></li>
<li title="Changing Non-Erlang Code">
<a href="appup_cookbook.html#id2276275">Changing Non-Erlang Code</a></li>
<li title="Emulator Restart">
<a href="appup_cookbook.html#id2276372">Emulator Restart</a></li>
</ul>
</li>
</ul>
</div></div>
<div id="content">
<div class="innertube">
<h1>1 Overview</h1>
  
  <p>The <strong>OTP Design Principles</strong> is a set of principles for how
    to structure Erlang code in terms of processes, modules and
    directories.</p>
  <h3><a name="id2252268">1.1 
        Supervision Trees</a></h3>
    
    <p>A basic concept in Erlang/OTP is the <strong>supervision tree</strong>.
      This is a process structuring model based on the idea of
      <strong>workers</strong> and <strong>supervisors</strong>.</p>
    <ul>
      <li>Workers are processes which perform computations, that is,
       they do the actual work.</li>
      <li>Supervisors are processes which monitor the behaviour of
       workers. A supervisor can restart a worker if something goes
       wrong.</li>
      <li>The supervision tree is a hierarchical arrangement of
       code into supervisors and workers, making it possible to
       design and program fault-tolerant software.</li>
    </ul>
    <a name="sup6"></a>
    <img alt="IMAGE MISSING" src="../design_principles/sup6.gif"><br>
      <em>Figure
        1.1:
         
        Supervision Tree</em>
    
    <p>In the figure above, square boxes represents supervisors and
      circles represent workers.</p>
  
  <h3><a name="id2258984">1.2 
        Behaviours</a></h3>
    
    <p>In a supervision tree, many of the processes have similar
      structures, they follow similar patterns. For example,
      the supervisors are very similar in structure. The only difference
      between them is which child processes they supervise. Also, many
      of the workers are servers in a server-client relation, finite
      state machines, or event handlers such as error loggers.</p>
    <p><strong>Behaviours</strong> are formalizations of these common patterns.
      The idea is to divide the code for a process in a generic part
      (a behaviour module) and a specific part (a <strong>callback module</strong>).</p>
    <p>The behaviour module is part of Erlang/OTP. To implement a
      process such as a supervisor, the user only has to implement
      the callback module which should export a pre-defined set of
      functions, the <strong>callback functions</strong>.</p>
    <p>An example to illustrate how code can be divided into a generic
      and a specific part: Consider the following code (written in
      plain Erlang) for a simple server, which keeps track of a number
      of "channels". Other processes can allocate and free the channels
      by calling the functions <span class="code">alloc/0</span> and <span class="code">free/1</span>,
      respectively.</p>
    <a name="ch1"></a>
    <div class="example"><pre>
-module(ch1).
-export([start/0]).
-export([alloc/0, free/1]).
-export([init/0]).
start() -&gt;
    spawn(ch1, init, []).
alloc() -&gt;
    ch1 ! {self(), alloc},
    receive
        {ch1, Res} -&gt;
            Res
    end.
free(Ch) -&gt;
    ch1 ! {free, Ch},
    ok.
init() -&gt;
    register(ch1, self()),
    Chs = channels(),
    loop(Chs).
loop(Chs) -&gt;
    receive
        {From, alloc} -&gt;
            {Ch, Chs2} = alloc(Chs),
            From ! {ch1, Ch},
            loop(Chs2);
        {free, Ch} -&gt;
            Chs2 = free(Ch, Chs),
            loop(Chs2)
    end.</pre></div>
    <p>The code for the server can be rewritten into a generic part
      <span class="code">server.erl</span>:</p>
    <div class="example"><pre>
-module(server).
-export([start/1]).
-export([call/2, cast/2]).
-export([init/1]).
start(Mod) -&gt;
    spawn(server, init, [Mod]).
call(Name, Req) -&gt;
    Name ! {call, self(), Req},
    receive
        {Name, Res} -&gt;
            Res
    end.
cast(Name, Req) -&gt;
    Name ! {cast, Req},
    ok.
init(Mod) -&gt;
    register(Mod, self()),
    State = Mod:init(),
    loop(Mod, State).
loop(Mod, State) -&gt;
    receive
        {call, From, Req} -&gt;
            {Res, State2} = Mod:handle_call(Req, State),
            From ! {Mod, Res},
            loop(Mod, State2);
        {cast, Req} -&gt;
            State2 = Mod:handle_cast(Req, State),
            loop(Mod, State2)
    end.</pre></div>
    <p>and a callback module <span class="code">ch2.erl</span>:</p>
    <div class="example"><pre>
-module(ch2).
-export([start/0]).
-export([alloc/0, free/1]).
-export([init/0, handle_call/2, handle_cast/2]).
start() -&gt;
    server:start(ch2).
alloc() -&gt;
    server:call(ch2, alloc).
free(Ch) -&gt;
    server:cast(ch2, {free, Ch}).
init() -&gt;
    channels().
handle_call(alloc, Chs) -&gt;
    alloc(Chs). % =&gt; {Ch,Chs2}
handle_cast({free, Ch}, Chs) -&gt;
    free(Ch, Chs). % =&gt; Chs2</pre></div>
    <p>Note the following:</p>
    <ul>
      <li>The code in <span class="code">server</span> can be re-used to build many
       different servers.</li>
      <li>The name of the server, in this example the atom
      <span class="code">ch2</span>, is hidden from the users of the client functions.
       This means the name can be changed without affecting them.</li>
      <li>The protcol (messages sent to and received from the server)
       is hidden as well. This is good programming practice and allows
       us to change the protocol without making changes to code using
       the interface functions.</li>
      <li>We can extend the functionality of <span class="code">server</span>, without
       having to change <span class="code">ch2</span> or any other callback module.</li>
    </ul>
    <p>(In <span class="code">ch1.erl</span> and <span class="code">ch2.erl</span> above, the implementation
      of <span class="code">channels/0</span>, <span class="code">alloc/1</span> and <span class="code">free/2</span> has been
      intentionally left out, as it is not relevant to the example.
      For completeness, one way to write these functions are given
      below. Note that this is an example only, a realistic
      implementation must be able to handle situations like running out
      of channels to allocate etc.)</p>
    <div class="example"><pre>
channels() -&gt;
   {_Allocated = [], _Free = lists:seq(1,100)}.
alloc({Allocated, [H|T] = _Free}) -&gt;
   {H, {[H|Allocated], T}}.
free(Ch, {Alloc, Free} = Channels) -&gt;
   case lists:member(Ch, Alloc) of
      true -&gt;
         {lists:delete(Ch, Alloc), [Ch|Free]};
      false -&gt;
         Channels
   end.        </pre></div>
    <p>Code written without making use of behaviours may be more
      efficient, but the increased efficiency will be at the expense of
      generality. The ability to manage all applications in the system
      in a consistent manner is very important.</p>
    <p>Using behaviours also makes it easier to read and understand
      code written by other programmers. Ad hoc programming structures,
      while possibly more efficient, are always more difficult to
      understand.</p>
    <p>The module <span class="code">server</span> corresponds, greatly simplified,
      to the Erlang/OTP behaviour <span class="code">gen_server</span>.</p>
    <p>The standard Erlang/OTP behaviours are:</p>
    <dl>
      <dt><strong><span class="bold_code">
<a href="gen_server_concepts.html">gen_server</a></span></strong></dt>
      <dd>For implementing the server of a client-server relation.</dd>
      <dt><strong><span class="bold_code">
<a href="fsm.html">gen_fsm</a></span></strong></dt>
      <dd>For implementing finite state machines.</dd>
      <dt><strong><span class="bold_code">
<a href="events.html">gen_event</a></span></strong></dt>
      <dd>For implementing event handling functionality.</dd>
      <dt><strong><span class="bold_code">
<a href="sup_princ.html">supervisor</a></span></strong></dt>
      <dd>For implementing a supervisor in a supervision tree.</dd>
    </dl>
    <p>The compiler understands the module attribute
      <span class="code">-behaviour(Behaviour)</span> and issues warnings about
      missing callback functions. Example:</p>
    <div class="example"><pre>
-module(chs3).
-behaviour(gen_server).
...
3&gt; c(chs3).
./chs3.erl:10: Warning: undefined call-back function handle_call/3
{ok,chs3}</pre></div>
  
  <h3><a name="id2252297">1.3 
        Applications</a></h3>
    
    <p>Erlang/OTP comes with a number of components, each implementing
      some specific functionality. Components are with Erlang/OTP
      terminology called <strong>applications</strong>. Examples of Erlang/OTP
      applications are Mnesia, which has everything needed for
      programming database services, and Debugger which is used to
      debug Erlang programs. The minimal system based on Erlang/OTP
      consists of the applications Kernel and STDLIB.</p>
    <p>The application concept applies both to program structure
      (processes) and directory structure (modules).</p>
    <p>The simplest kind of application does not have any processes,
      but consists of a collection of functional modules. Such an
      application is called a <strong>library application</strong>. An example
      of a library application is STDLIB.</p>
    <p>An application with processes is easiest implemented as a
      supervision tree using the standard behaviours.</p>
    <p>How to program applications is described in
      <span class="bold_code">
<a href="applications.html">Applications</a></span>.</p>
  
  <h3><a name="id2252171">1.4 
        Releases</a></h3>
    
    <p>A <strong>release</strong> is a complete system made out from a subset of
      the Erlang/OTP applications and a set of user-specific
      applications.</p>
    <p>How to program releases is described in
      <span class="bold_code">
<a href="release_structure.html">Releases</a></span>.</p>
    <p>How to install a release in a target environment is described
      in the chapter about Target Systems in System Principles.</p>
  
  <h3><a name="id2254710">1.5 
        Release Handling</a></h3>
    
    <p><strong>Release handling</strong> is upgrading and downgrading between
      different versions of a release, in a (possibly) running system.
      How to do this is described in
      <span class="bold_code">
<a href="release_handling.html">Release Handling</a></span>.</p>
  
</div>
<div class="footer">
<hr>
<p>Copyright © 1997-2009 Ericsson AB. All Rights Reserved.</p>
</div>
</div>
</div>
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-3045895-1";
urchinTracker();
</script> 
</body>
</html>
